<StepManager as |w|>
  {{#each this.changesets as |changeset index|}}
    <w.Step @name={{index}}>
      <BsForm
        @onSubmit={{this.submit}}
        @model={{changeset}}
      as |form|
      >
        {{#each-in changeset.data as |key|}}
          <form.element
            @controlType={{changeset-get changeset (concat key ".type")}}
            @label={{str-capitalize (changeset-get changeset (concat key ".ui.label"))}}
            @property={{concat key ".value"}}
            as |el|>
            {{#if (eq (changeset-get changeset (concat key ".type")) "group")}}
              {{component
                (changeset-get changeset (concat key ".ui.component.name"))
                options=(changeset-get changeset (concat key ".ui.component.options"))
                selected=(changeset-get changeset (concat key ".value"))
                onSelection=el.setValue
              }}
            {{else}}
              <el.control
                placeholder={{changeset-get changeset (concat key ".ui.placeholder")}}
                readonly={{changeset-get changeset (concat key ".ui.readonly")}}
              />
            {{/if}}
            </form.element>
        {{/each-in}}

        {{#let (eq index 0) as |isFirstForm|}}
          {{#unless isFirstForm}}
            <button
              type="button"
              class="btn btn-secondary"
              {{on "click" (fn w.transition-to (sub index 1))}}
            >
              Go Back
            </button>
          {{/unless}}
        {{/let}}

        {{#let (eq index (sub changesets.length 1)) as |isLastForm|}}
          {{#unless isLastForm}}
            <button
              type="submit"
              class="btn btn-success"
              {{on "click" (fn this.continueIfValid changeset w index)}}
            >
              Continue
            </button>
          {{/unless}}
          {{#if isLastForm}}
            <form.submitButton
            >
              Submit
            </form.submitButton>
          {{/if}}
        {{/let}}
      </BsForm>
    </w.Step>
  {{/each}}
</StepManager>
